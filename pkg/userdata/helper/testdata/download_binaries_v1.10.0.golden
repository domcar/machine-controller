#!/bin/bash
set -xeuo pipefail

mkdir -p /opt/bin/

# crictl
if [ ! -f /opt/bin/crictl ]; then
    wget -O /opt/crictl.tar.gz https://github.com/kubernetes-sigs/cri-tools/releases/download/v1.0.0-beta.1/crictl-v1.0.0-beta.1-linux-amd64.tar.gz
    tar -xvf /opt/crictl.tar.gz -C /opt/bin/
fi

# cni
if [ ! -f /opt/cni/bin/loopback ]; then
    wget -O /opt/cni-plugins.tar.gz https://github.com/containernetworking/plugins/releases/download/v0.6.0/cni-plugins-amd64-v0.6.0.tgz
    mkdir -p /opt/cni/bin /etc/cni/net.d
    tar -xvf /opt/cni-plugins.tar.gz -C /opt/cni/bin/
fi

# runc
if [ ! -f /opt/bin/runc ]; then
    wget -O /opt/bin/runc https://github.com/opencontainers/runc/releases/download/v1.0.0-rc5/runc.amd64        
    chmod +x /opt/bin/runc
fi

# containerd
if [ ! -f /opt/bin/containerd ]; then
    wget -O /opt/containerd.tar.gz https://github.com/containerd/containerd/releases/download/v1.2.0-rc.1/containerd-1.2.0-rc.1.linux-amd64.tar.gz
    sudo tar -xvf /opt/containerd.tar.gz -C /opt/
fi

# kubelet
if [ ! -f /opt/bin/kubelet ]; then
    wget -O /opt/bin/kubelet https://storage.googleapis.com/kubernetes-release/release/v1.10.0/bin/linux/amd64/kubelet
    chmod +x /opt/bin/kubelet
fi
